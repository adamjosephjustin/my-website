<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L10: Building a Shape</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .drawing-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            width: 180px;
            height: 180px;
            margin: 20px auto;
            border: 1px solid #ccc;
        }
        .grid-cell {
            width: 60px;
            height: 60px;
            background: #fff;
            border: 1px solid #eee;
            box-sizing: border-box;
            font-size: 0.8rem;
            color: #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .grid-cell.filled { 
            background-color: var(--color-primary); 
            transition: background-color 0.3s;
        }
    </style>
</head>
<body>
    <header class="academy-header">
        <h1>Lesson 10: Building a Shape</h1>
        <p><a href="../index.html" style="color: var(--color-accent);">‚Üê Back to Course Index</a></p>
    </header>

    <div class="lesson-page-container">
        <p><strong>Goal:</strong> Combine **Sequencing** and **Loops**! Draw a small 2x2 blue square on the grid by moving the robot ü§ñ and filling cells.</p>
        
        <div class="game-area">
            <h3 style="color: var(--color-primary);">The Canvas:</h3>
            <div class="drawing-grid" id="drawing-grid">
                <div class="grid-cell" data-row="0" data-col="0"></div>
                <div class="grid-cell" data-row="0" data-col="1"></div>
                <div class="grid-cell" data-row="0" data-col="2"></div>

                <div class="grid-cell" data-row="1" data-col="0"></div>
                <div class="grid-cell" data-row="1" data-col="1"></div>
                <div class="grid-cell" data-row="1" data-col="2"></div>

                <div class="grid-cell" data-row="2" data-col="0"></div>
                <div class="grid-cell" data-row="2" data-col="1"></div>
                <div class="grid-cell" data-row="2" data-col="2"></div>
            </div>
            
            <p><strong>Instructions:</strong> Start at **(0, 0)**. You must fill cells **(1,1), (1,2), (2,1), (2,2)** to make a square!</p>
            
            <button id="fill-cell-btn" class="game-button">Fill Cell üé®</button>
            <button id="move-right-btn" class="game-button">Move Right ‚Üí</button>
            <button id="move-down-btn" class="game-button">Move Down ‚Üì</button>
            <button id="reset-btn" class="game-button" style="background-color: #E74C3C;">Reset</button>

            <div class="game-feedback" id="game-feedback">Current Position: (0,0). Click commands to draw.</div>
        </div>
        
        <a href="#" id="next-btn" class="game-button hidden">Next Lesson ‚Üí</a>
    </div>

    <script src="../js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initializeLesson(10); 
            
            const feedback = document.getElementById('game-feedback');
            const gridCells = document.querySelectorAll('.grid-cell');
            
            let robotPosition = { row: 0, col: 0 };
            const drawnCells = new Set();
            const targetCells = new Set(['1,1', '1,2', '2,1', '2,2']);

            function updateRobotPosition() {
                gridCells.forEach(cell => cell.innerHTML = '');
                const key = `${robotPosition.row},${robotPosition.col}`;
                const currentCell = document.querySelector(`[data-row="${robotPosition.row}"][data-col="${robotPosition.col}"]`);
                
                if (currentCell) {
                    currentCell.innerHTML = 'ü§ñ';
                }
                feedback.innerText = `Current Position: (${key}).`;
                checkCompletion();
            }

            function fillCell() {
                const key = `${robotPosition.row},${robotPosition.col}`;
                const currentCell = document.querySelector(`[data-row="${robotPosition.row}"][data-col="${robotPosition.col}"]`);
                
                if (currentCell && targetCells.has(key)) {
                    currentCell.classList.add('filled');
                    drawnCells.add(key);
                    feedback.innerText = `Filled cell (${key})!`;
                } else if (currentCell) {
                    feedback.innerText = `‚ö†Ô∏è You filled cell (${key})! Only fill cells within the target 2x2 square.`;
                }
                updateRobotPosition();
            }

            function move(dr, dc) {
                const newRow = Math.max(0, Math.min(2, robotPosition.row + dr));
                const newCol = Math.max(0, Math.min(2, robotPosition.col + dc));
                robotPosition = { row: newRow, col: newCol };
                updateRobotPosition();
            }
            
            function resetPuzzle() {
                robotPosition = { row: 0, col: 0 };
                drawnCells.clear();
                gridCells.forEach(cell => cell.classList.remove('filled'));
                document.getElementById('fill-cell-btn').disabled = false;
                document.getElementById('move-right-btn').disabled = false;
                document.getElementById('move-down-btn').disabled = false;
                updateRobotPosition();
                feedback.innerText = "Puzzle reset! Start drawing the 2x2 square.";
            }

            function checkCompletion() {
                let all
