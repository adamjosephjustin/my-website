<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L3: Fixing the Wire</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        /* Add specific styling for the wires */
        .wire-bundle {
            background-color: #E6E6FA; /* Lavender background */
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            flex-basis: 120px; /* fixed size for better layout */
        }
        .wire-bundle[data-order="1"] { border: 3px solid #FFD700; } /* Gold border for correct wire */
        .wire-bundle[data-order="2"] { border: 3px solid #C0C0C0; } /* Silver border */
        .wire-bundle[data-order="3"] { border: 3px solid #CD7F32; } /* Bronze border */
    </style>
</head>
<body>
    <header class="academy-header">
        <h1>Lesson 3: Fixing the Wire</h1>
        <p><a href="../index.html" style="color: var(--color-accent);">â† Back to Course Index</a></p>
    </header>

    <div class="lesson-page-container">
        <p><strong>Goal:</strong> Practice **Debugging**! The computer ğŸ’» is broken because the wires are out of order. Find the error and fix it!</p>
        
        <div class="game-area">
            <h3 style="color: #E74C3C;">The Problem:</h3>
            <p>The code must run 1, 2, 3, but the wires are mixed up!</p>
            
            <div id="wire-puzzle" style="display: flex; gap: 20px; justify-content: center; margin: 20px 0;">
                <div class="wire-bundle" data-step="1" data-order="2">
                    <div style="font-size: 2rem; color: #5B2C6F;">Wire 2</div>
                    <div style="color: #8E44AD; font-size: 3rem;">ğŸ”Œ</div>
                </div>
                <div class="wire-bundle" data-step="2" data-order="1">
                    <div style="font-size: 2rem; color: #5B2C6F;">Wire 1</div>
                    <div style="color: #8E44AD; font-size: 3rem;">ğŸ”Œ</div>
                </div>
                <div class="wire-bundle" data-step="3" data-order="3">
                    <div style="font-size: 2rem; color: #5B2C6F;">Wire 3</div>
                    <div style="color: #8E44AD; font-size: 3rem;">ğŸ”Œ</div>
                </div>
            </div>

            <button id="check-btn" class="game-button" style="background-color: #E74C3C;">Check Wires</button>
            
            <div class="game-feedback" id="game-feedback">Click 'Wire 2' and 'Wire 1' to swap them and fix the sequence (1, 2, 3)!</div>
        </div>
        
        <a href="#" id="next-btn" class="game-button hidden">Next Lesson â†’</a>
    </div>

    <script src="../js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initializeLesson(3); 
            
            const wiresContainer = document.getElementById('wire-puzzle');
            const wires = Array.from(wiresContainer.querySelectorAll('.wire-bundle'));
            const checkBtn = document.getElementById('check-btn');
            const feedback = document.getElementById('game-feedback');
            let selectedWire = null;

            // --- Corrected Swap Logic ---
            function swapWires(wire1, wire2) {
                // 1. Swap the visual elements in the DOM
                const parent = wiresContainer;
                
                // Get the elements right after wire1 and wire2 to determine insertion points
                const nextWire1 = wire1.nextElementSibling;
                const nextWire2 = wire2.nextElementSibling;

                if (nextWire1 === wire2) {
                    // Case: wire1 and wire2 are adjacent
                    parent.insertBefore(wire2, wire1);
                } else if (nextWire2 === wire1) {
                    // Case: wire2 and wire1 are adjacent
                    parent.insertBefore(wire1, wire2);
                } else {
                    // Case: wires are separated
                    parent.insertBefore(wire2, nextWire1);
                    parent.insertBefore(wire1, nextWire2);
                }
            }

            wires.forEach(wire => {
                wire.style.cursor = 'pointer';
                wire.style.transition = 'border 0.2s';

                wire.onclick = function() {
                    if (selectedWire === this) {
                        // Deselect
                        this.style.outline = 'none';
                        selectedWire = null;
                        feedback.innerText = "Wire deselected.";
                    } else if (selectedWire) {
                        // Swap with the previously selected wire
                        swapWires(selectedWire, this);
                        
                        selectedWire.style.outline = 'none';
                        this.style.outline = 'none';
                        selectedWire = null;
                        feedback.innerText = "Wires swapped! Click 'Check Wires'!";
                        
                        // Re-fetch the list in new order for the check button
                        wires.length = 0; // Clear the array reference
                        wires.push(...Array.from(wiresContainer.querySelectorAll('.wire-bundle')));
                    } else {
                        // Select first wire
                        selectedWire = this;
                        this.style.outline = '4px solid var(--color-accent)'; 
                        feedback.innerText = "First wire selected. Click another to swap.";
                    }
                };
            });

            checkBtn.onclick = function() {
                // Get the current order based on their DOM position
                const currentOrder = Array.from(wiresContainer.children).map(w => w.querySelector('div:first-child').innerText.replace('Wire ', ''));
                const correctOrder = ['1', '2', '3'];

                if (JSON.stringify(currentOrder) === JSON.stringify(correctOrder)) {
                    feedback.innerText = "ğŸ‰ Debugged! The wires are 1, 2, 3. The circuit is running!";
                    checkBtn.disabled = true;
                    Array.from(wiresContainer.children).forEach(w => w.onclick = null); // Disable all clicks
                    window.lessonSuccess();
                } else {
                    feedback.innerText = `âŒ Error! Current order is ${currentOrder.join(', ')}. Keep swapping!`;
                    feedback.style.color = '#E74C3C';
                }
            };
        });
    </script>
</body>
</html>
